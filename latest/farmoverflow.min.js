/*! farmoverflow.min.js@2.2.3 | Licence MIT */
!function(a,b){a.Lockr=function(a,b){"use strict";return b.prefix="",b._getPrefixedKey=function(a,b){return b=b||{},b.noPrefix?a:this.prefix+a},b.set=function(a,b,c){var d=this._getPrefixedKey(a,c);try{localStorage.setItem(d,JSON.stringify({data:b}))}catch(a){}},b.get=function(a,b,c){var d,e=this._getPrefixedKey(a,c);try{d=JSON.parse(localStorage.getItem(e))}catch(a){d=localStorage[e]?{data:localStorage.getItem(e)}:null}return null===d?b:"object"==typeof d&&void 0!==d.data?d.data:b},b}(a,{})}(this),function(a,b){"use strict";function c(a){let b={};for(let c in a)a[c]>0&&(b[c]=a[c]);return b}function d(a){a=parseInt(a,10);let b=a+a/2,c=a-a/2;return Math.round(Math.random()*(b-c)+c)}function e(a){return a=a.split(":"),a[0]=60*parseInt(a[0],10)*60,a[1]=60*parseInt(a[1],10),a[2]=parseInt(a[2],10),a.reduce((a,b)=>a+b)}function f(a,b){return a.replace(/{(\d+)}/g,function(a,c){return void 0!==b[c].html?b[c].html:a})}function g(a,b){let c,d,e=/{{(.+?)}}/g,f="with(obj) { var r=[];\n",g=0,h=function(a,b){f+=b?a.match(/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g)?a+"\n":"r.push("+a+");\n":""!=a?'r.push("'+a.replace(/"/g,'\\"')+'");\n':""};for(;d=e.exec(a);)h(a.slice(g,d.index)),h(d[1],!0),g=d.index+d[0].length;h(a.substr(g,a.length-g)),f=(f+'return r.join(""); }').replace(/[\r\t\n]/g," ");try{c=new Function("obj",f).apply(b,[b])}catch(a){}return c}function h(a,b,c){let d=Math.round(1e5*Math.random()),e=g('<a id="l{{ uid }}" class="img-link icon-20x20-{{ type }} btn btn-orange padded">{{ text }}</a>',{type:a,text:b,uid:d}),f=document.createElement("div");f.innerHTML=e,f=f.firstChild;let h;switch(a){case"village":h=function(){o.openVillageInfo(c)};break;case"character":h=function(){o.openCharacterProfile(c)}}return f.addEventListener("click",h),{html:e,id:"l"+d,elem:f}}let i=angular.element(document).scope(),j=injector.get("modelDataService"),k=injector.get("socketService"),l=injector.get("routeProvider"),m=injector.get("eventTypeProvider"),n=injector.get("$filter"),o=injector.get("windowDisplayService"),p=injector.get("windowManagerService"),q=injector.get("hotkeys"),r=injector.get("armyService"),s=injector.get("villageService"),t=j.getPresetList(),u=/(\(|\{|\[|\"|\')[^\)\}\]\"\']+(\)|\}|\]|\"|\')/;define("FarmOverflow",["FarmOverflow/Commander","FarmOverflow/analytics","FarmOverflow/Village","helper/math","conf/conf","struct/MapData","helper/mapconvert","helper/time","conf/locale"],function(a,b,d,e,f,g,h,o,p){function q(){let b={maxDistance:10,minDistance:0,maxTravelTime:"01:00:00",randomBase:3,presetName:"",groupIgnore:0,groupInclude:0,groupOnly:0,minPoints:0,maxPoints:12500,eventsLimit:20,ignoreOnLoss:!1,language:"",priorityTargets:!0,eventAttack:!0,eventVillageChange:!0,eventPriorityAdd:!0,eventIgnoredVillage:!0,remoteId:"remote",hotkeySwitch:"shift+z",hotkeyWindow:"z"},c=Lockr.get("settings",{},!0);return this.settings=angular.merge({},b,c),this.version="2.2.3",this.player=j.getSelectedCharacter(),this.villages=null,this.village=null,this.singleVillage=null,this.targets={},this.target=null,this.eventListeners={},this.eventsEnabled=!0,this.notifsEnabled=!0,this.presets=[],this.groupIgnore=null,this.groupInclude=null,this.groupOnly=null,this.ignoredVillages=[],this.includedVillages=[],this.indexes=Lockr.get("indexes",{},!0),this.waiting={},this.globalWaiting=!1,this.lastError="",this.commander=new a(this),this.priorityTargets={},this.activeListeners=[],this.lastActivity=Lockr.get("lastActivity",o.gameTime(),!0),this.lastAttack=Lockr.get("lastAttack",-1,!0),this.updateExceptionGroups(),this.updateExceptionVillages(),this.updatePlayerVillages(),this.updatePresets(),this.languages(),this.listeners(),this.status=this.lang.events.paused,this}return q.prototype.start=function(){if(!this.presets.length)return this.notif("error",this.lang.events.presetFirst);if(!this.village)return this.notif("error",this.lang.events.noSelectedVillage);let c=o.gameTime();return c>this.lastActivity+6e5&&(this.priorityTargets={}),c>this.lastActivity+18e5&&(this.indexes={},Lockr.set("indexes",{})),this.commander=new a(this),this.commander.start(),this.notif("success",this.lang.general.started),b.start(),!0},q.prototype.stop=function(){return this.commander.stop(),this.notif("success",this.lang.general.paused),b.pause(),!0},q.prototype.switch=function(){this.commander&&this.commander.running?this.stop():this.start()},q.prototype.notif=function(a,b){if(!this.notifsEnabled)return!1;let c="success"===a?m.MESSAGE_SUCCESS:m.MESSAGE_ERROR;i.$broadcast(c,{message:b})},q.prototype.updateActivity=function(){this.lastActivity=o.gameTime(),Lockr.set("lastActivity",this.lastActivity)},q.prototype.updateLastAttack=function(){this.lastAttack=o.gameTime(),Lockr.set("lastAttack",this.lastAttack)},q.prototype.updateLastStatus=function(a){this.status=a},q.prototype.updateSettings=function(a){let c={},d={groupIgnore:["groups"],groupInclude:["groups","targets"],groupOnly:["groups","villages","targets"],presetName:["preset"],minDistance:["targets"],maxDistance:["targets"],minPoints:["targets"],maxPoints:["targets"],eventsLimit:["events"],eventAttack:["events"],eventVillageChange:["events"],eventPriorityAdd:["events"],eventIgnoredVillage:["events"]};for(let b in a){if(a[b]!==this.settings[b]){let a=d[b];if(d.hasOwnProperty(b))for(let b=0;b<a.length;b++)c[a[b]]=!0}this.settings[b]=a[b]}if(Lockr.set("settings",this.settings),angular.equals(c,{}))return!1;c.groups&&(this.updateExceptionGroups(),this.updateExceptionVillages()),c.villages&&this.updatePlayerVillages(),c.preset&&this.updatePresets(),c.targets&&(this.targets={}),c.events&&this.event("resetEvents"),this.commander.running&&this.globalWaiting&&this.disableEvents(()=>{this.stop();this.start()}),b.settingsChange(localStorage[Lockr.prefix+"settings"])},q.prototype.disableEvents=function(a){this.eventsEnabled=!1,a(),this.eventsEnabled=!0},q.prototype.disableNotifs=function(a){this.notifsEnabled=!1,a(),this.notifsEnabled=!0},q.prototype.nextTarget=function(a){let b=this.village.id;if(!this.targets[b])return this.commander.analyse(),!1;let c=this.targets[b];if(this.settings.priorityTargets&&this.priorityTargets[b]){let a;for(;a=this.priorityTargets[b].shift();)if(!this.ignoredVillages.includes(a))for(let b=0;b<c.length;b++)if(c[b].id===a)return this.target=c[b],!0}let d=this.indexes[b],e=!1;for(a||(d=++this.indexes[b]);d<c.length;d++){let a=c[d];if(!this.ignoredVillages.includes(a.id)){this.target=a,e=!0;break}this.event("ignoredTarget",[a])}return e?this.indexes[b]=d:(this.target=c[0],this.indexes[b]=0),Lockr.set("indexes",this.indexes),!0},q.prototype.selectTarget=function(){return this.nextTarget(!0)},q.prototype.hasTarget=function(){let a=this.village.id,b=this.indexes[a],c=this.targets[a];return!!c.length&&(b>c.length&&(this.indexes[a]=b=0),!!c[b])},q.mapFilters=[function(a,b){if(b.id<0)return!0},function(a,b){if(b.character_id===a.player.getId())return!0},function(a,b){if(b.attack_protection)return!0},function(a,b){if(b.character_id){let c=a.includedVillages.includes(b.id);if(!c)return!0}},function(a,b){return b.points<a.settings.minPoints||(b.points>a.settings.maxPoints||void 0)},function(a,b){let c=a.village.position,d=e.actualDistance(c,b);return d<a.settings.minDistance||(d>a.settings.maxDistance||void 0)}],q.prototype.getTargets=function(a){let b=this.village.position,c=this.village.id;if(c in this.targets)return a();let d=[],i=f.MAP_CHUNK_SIZE,j=b.x-i,k=b.y-i,l=2*i,m=2*i,n=()=>{let a=g.hasTownDataInChunk(j,k);if(a)o();else{this.event("startLoadingTargers");let a=h.scaledGridCoordinates(j,k,l,m,i),b=a.length,c=0;g.loadTownDataAsync(j,k,l,m,()=>{++c===b&&(this.event("endLoadingTargers"),o())})}return},o=()=>{let a=g.loadTownData(j,k,l,m,i);let b=a.length;for(;b--;){let c=a[b],e=c.data;for(let a in e){let b=e[a];for(let a in b){let c=b[a],e=p(c);e&&d.push(e)}}}r()},p=a=>{let c=q.mapFilters.every(b=>!b(this,a));if(!c)return!1;return{x:a.x,y:a.y,distance:e.actualDistance(b,a),id:a.id,name:a.name,pid:a.character_id}},r=()=>{if(0===d.length){let b=this.nextVillage();return b?this.getTargets(a):this.event("noTargets"),!1}this.targets[c]=d.sort(function(a,b){return a.distance-b.distance});this.indexes.hasOwnProperty(c)?this.indexes[c]>this.targets[c].length&&(this.indexes[c]=0,Lockr.set("indexes",this.indexes)):(this.indexes[c]=0,Lockr.set("indexes",this.indexes));a()};return n()},q.prototype.nextVillage=function(){if(this.singleVillage)return!1;let a=this.villages.filter(a=>!this.waiting[a.id]);if(!a.length)return this.event("noVillages"),!1;if(1===a.length)return this.village=a[0],this.event("nextVillage",[this.village]),!0;let b=a.indexOf(this.village)+1;return this.village=a[b]?a[b]:a[0],this.event("nextVillage",[this.village]),this.updateActivity(),!0},q.prototype.selectVillage=function(a){let b=this.villages.indexOf(a);return-1!==b&&(this.village=this.villages[b],!0)},q.prototype.event=function(a,b){if(!this.eventsEnabled)return this;if(a in this.eventListeners){let c=this.eventListeners[a];for(let a=0;a<c.length;a++)c[a].apply(this,b)}return this},q.prototype.on=function(a,b){return"function"==typeof b&&(a in this.eventListeners||(this.eventListeners[a]=[]),this.eventListeners[a].push(b)),this},q.prototype.updatePresets=function(a){let b=b=>{this.presets=[];if(!this.settings.presetName)return void(a&&a());for(let a in b)if(b.hasOwnProperty(a)){let d=b[a].name,e=d.replace(u,"").trim();e===this.settings.presetName&&(b[a].cleanName=e,b[a].units=c(b[a].units),this.presets.push(b[a]))}a&&a()};t.isLoaded()?b(t.presets):k.emit(l.GET_PRESETS,{},a=>{this.event("presetsLoaded");b(a.presets)})},q.prototype.assignPresets=function(a,b){k.emit(l.ASSIGN_PRESETS,{village_id:this.village.id,preset_ids:a},b)},q.prototype.checkPresets=function(a){if(!this.presets.length)return this.stop(),this.event("noPreset"),!1;let b=this.village.id,c=t.getPresetsByVillageId(b),d=!1,e=[];for(let a of this.presets)c.hasOwnProperty(a.id)||(d=!0,e.push(a.id));if(d){for(let a in c)e.push(a);this.assignPresets(e,a)}else a()},q.prototype.updateExceptionGroups=function(){let a=["groupIgnore","groupInclude","groupOnly"],b=j.getGroupList().getGroups();for(let c of a){this[c]=null;for(let a in b)if(a==this.settings[c]){this[c]={name:b[a].name,id:a};break}}},q.prototype.updateExceptionVillages=function(){let a=j.getGroupList();this.ignoredVillages=[],this.includedVillages=[],this.groupIgnore&&(this.ignoredVillages=a.getGroupVillageIds(this.groupIgnore.id)),this.groupInclude&&(this.includedVillages=a.getGroupVillageIds(this.groupInclude.id))},q.prototype.updatePlayerVillages=function(){let a=this.player.getVillageList();if(a=a.map(a=>new d(a)),a=a.filter(a=>!this.ignoredVillages.includes(a.id)),this.groupOnly){let b=j.getGroupList(),c=b.getGroupVillageIds(this.groupOnly.id);a=a.filter(a=>c.includes(a.id))}if(this.villages=a,this.singleVillage=1===this.villages.length,this.village=this.villages[0],this.commander.running&&this.globalWaiting)for(let b=0;b<a.length;b++){let c=a[b];if(!this.waiting[c.id]){this.globalWaiting=!1,this.commander.analyse();break}}this.event("villagesUpdate")},q.prototype.ignoreVillage=function(a){if(!this.groupIgnore)return!1;k.emit(l.GROUPS_LINK_VILLAGE,{group_id:this.groupIgnore.id,village_id:a.id},()=>{this.event("ignoredVillage",[a])})},q.prototype.targetExists=function(a){for(let b in this.targets){let c=this.targets[b];for(let b=0;b<c.length;b++){let d=c[b];if(d.id===a)return d}}return!1},q.prototype.listeners=function(){function a(a,b){setTimeout(function(){k.emit(l.MESSAGE_REPLY,{message_id:a,message:b})},300)}let c=(a,b)=>{let c=b.origin.id;if(this.waiting[c])return delete this.waiting[c],this.globalWaiting&&(this.globalWaiting=!1,this.commander.running&&(this.selectVillage(c),setTimeout(()=>{this.commander.analyse()},1e4))),!1},d=()=>{this.updatePresets();this.event("presetsChange");this.presets.length||this.commander.running&&(this.event("noPreset"),this.stop())},e=(a,b)=>{this.updateExceptionGroups();this.updateExceptionVillages();this.event("groupsChanged")},f=(a,b)=>{this.updatePlayerVillages();if(!this.groupInclude)return!1;this.groupInclude.id===b.group_id&&(this.targets={})},h=a=>{let c=this.targetExists(a.target_village_id);if(!c)return!1;this.ignoreVillage(c);b.ignoreTarget();return!0},j=a=>{let c=a.attVillageId;let d=a.defVillageId;this.priorityTargets[c]=this.priorityTargets[c]||[];if(this.priorityTargets[c].includes(d))return!1;this.priorityTargets[c].push(d);b.priorityTarget();this.event("priorityTargetAdded",[{id:d,name:a.defVillageName,x:a.defVillageX,y:a.defVillageY}])},o=(a,b)=>{if("attack"!==b.type)return!1;let c=[];this.settings.ignoreOnLoss&&1!==b.result&&h(b);this.settings.priorityTargets&&"full"===b.haul&&c.push(j);if(!c.length)return!1;k.emit(l.REPORT_GET,{id:b.id},a=>{k.emit(l.REPORT_MARK_UNREAD,{reports:[a.id]},function(){});let b=a.ReportAttack;c.every(function(a){a(b)})})},p=(a,b)=>{this.commander.running&&setTimeout(()=>{this.disableNotifs(()=>{this.stop();this.start()})},3e3)},q=(c,d)=>{let e=this.settings.remoteId;if(1!==d.participants.length||d.title!==e)return!1;let f=d.message.content.trim().toLowerCase();switch(f){case"on":this.disableNotifs(()=>{this.stop();this.start()}),a(d.message_id,"[color=0a8028]OK[/color]"),b.remoteCommand();break;case"off":this.disableNotifs(()=>{this.stop()}),a(d.message_id,"[color=0a8028]OK[/color]"),b.remoteCommand();break;case"status":let c=this.village,e=`${c.name} (${c.x}|${c.y})`,g=n("readableDateFilter")(this.lastAttack),h=[`[b]${this.lang.events.status}:[/b] ${this.status}[br]`,`[b]${this.lang.events.selectedVillage}:[/b] `,`[village=${c.id}]${e}[/village][br]`,`[b]${this.lang.events.lastAttack}:[/b] ${g}`].join("");a(d.message_id,h),b.remoteCommand()}return!1},r=(a,b)=>{let c=i.$on(m[a],b);this.activeListeners.push(c)};r("COMMAND_RETURNED",c),r("ARMY_PRESET_UPDATE",d),r("ARMY_PRESET_DELETED",d),r("GROUPS_UPDATED",e),r("GROUPS_CREATED",e),r("GROUPS_DESTROYED",e),r("GROUPS_VILLAGE_LINKED",f),r("GROUPS_VILLAGE_UNLINKED",f),r("REPORT_NEW",o),r("RECONNECT",p),r("MESSAGE_SENT",q),g.setRequestFn(function(a){k.emit(l.MAP_GETVILLAGES,a)});let s=this.lang.events;this.on("sendCommand",()=>{this.updateLastAttack();this.updateLastStatus(s.attacking)}),this.on("noPreset",()=>this.updateLastStatus(s.paused)),this.on("noUnits",()=>this.updateLastStatus(s.noUnits)),this.on("noUnitsNoCommands",()=>this.updateLastStatus(s.noUnitsNoCommands)),this.on("start",()=>this.updateLastStatus(s.attacking)),this.on("pause",()=>this.updateLastStatus(s.paused)),this.on("startLoadingTargers",()=>this.updateLastStatus(s.loadingTargets)),this.on("endLoadingTargers",()=>this.updateLastStatus(s.analyseTargets)),this.on("commandLimitSingle",()=>this.updateLastStatus(s.commandLimit)),this.on("commandLimitMulti",()=>this.updateLastStatus(s.noVillages))},q.prototype.targetsLoaded=function(){return this.targets.hasOwnProperty(this.village.id)},q.prototype.hasVillage=function(){return!!this.village},q.prototype.isWaiting=function(){return this.waiting.hasOwnProperty(this.village.id)},q.prototype.isIgnored=function(){return this.ignoredVillages.includes(this.village.id)},q.prototype.isAllWaiting=function(){for(let a=0;a<this.villages.length;a++){let b=this.villages[a].id;if(!this.waiting.hasOwnProperty(b))return!1}return!0},q.prototype.languages=function(){let a={pt_br:{title:"FarmOverflow",events:{attacking:"Atacando.",commandLimit:"Limite de 50 ataques atingido, aguardando retorno.",lastAttack:"Último ataque",nextVillage:"Alternando para a aldeia {0}",noPreset:"Nenhuma predefinição disponível.",noSelectedVillage:"Nenhuma aldeia disponível.",noUnits:"Sem unidades na aldeia, aguardando ataques retornarem.",noUnitsNoCommands:"Nenhuma aldeia tem tropas nem ataques retornando.",noVillages:"Nenhuma aldeia disponível, aguardando ataques retornarem.",nothingYet:"Nada por aqui ainda...",paused:"Pausado.",presetFirst:"Configure uma predefinição primeiro!",selectedVillage:"Aldeia selecionada",sendCommand:"{0} ataca {1}",status:"Status",loadingTargets:"Carregando alvos...",checkingTargets:"Checando alvos...",restartingCommands:"Reiniciando comandos...",ignoredVillage:"Alvo {0} ignorado! (causou baixas)",priorityTargetAdded:"{0} adicionado as prioridades."},general:{disabled:"— Desativado —",events:"Registros",info:"Informações",none:"Nenhum",pause:"Pausar",paused:"FarmOverflow pausado.",settings:"Configurações",start:"Iniciar",started:"FarmOverflow iniciado."},info:{development:["Desenvolvimento","Desenvolvido do <span class='brazil'>Brasil</span> com <strong style='color:#ad0202'>❤</strong> por","Qualquer email reportando erro, sugestão, mensagem amor ou ódio será bem vinda.","Esse projeto é"],groupOnly:["Usando apenas aldeias de um grupo para atacar","Você pode selecionar um grupo especifico para usar apenas as aldeias desse grupo para enviar os ataques."],ignore:["Ignorando aldeias com grupo","Você pode selecionar um grupo nas configurações para que todas aldeias atribuidas a esse grupo sejam ignorados pelo FarmOverflow. <strong>O grupo serve tanto para os alvos quanto para suas aldeias</strong>."],include:["Incluindo alvos com grupo","Assim como ignorar aldeias, você pode incluir como alvos aldeias de jogadores. Todas aldeias do grupo que estiverem fora da distância máxima não seram incluidas."],presets:["Configurando predefinições","O FarmOverflow utiliza as próprias predefinições do jogo configuradas por você, basta você selecionar uma na aba configurações, salvar e iniciar!","Como o jogo só permite enviar predefinições que estejam ativas na aldeia, o FarmOverflow irá ativa-las automaticamente caso já não estejam.","Você pode usar mais de uma predefinição, <strong>desde que tenham o mesmo nome</strong> (você pode adicionar uma pequena descrição na frente do nome para identifica-las melhor).","Veja alguns exemplos para os nomes das predefinições:","Atenção com os <strong>oficiais</strong>, eles <strong>serão utilizados</strong> caso estejam ativos nas predefinições."],randomBase:["Base do intervalo aleatório","Esse intervalo é usado para gerar um tempo aleatório (em segundos) entre cada ataque evitando o FarmOverflow ser detectado. <strong>Quanto maior melhor</strong>."],ignoreOnLoss:["Ignorando alvos que causam perdas","Qualquer ataque que tenha causado alguma perca nas suas tropas será ignorado em ataques futuros.",'<strong>Atenção</strong>: Para essa funcionalidade funcionar é preciso ter a opção "Ignorando aldeias com grupo" configurada.','Todas aldeias que forem ignoradas será avisado na aba "Avisos".'],priorityTargets:["Priorizando alvos","Quando ativada, todos os alvos que tiverem relatórios com saque no máximo, serão adicionados na lista de prioridades para reenviar o ataque assim que possível."],remote:["Controlando remotamente via mensagem","Deixe o FarmOverflow funcionando em casa e o controle pelo app do jogo!",'Configure o assunto da mensagem por onde você controlará o FarmOverflow na aba "Configurações"',"Crie uma mensagem e adicione você mesmo como destinatário. No assunto coloque o que você configurou e no corpo da mensagem use um dos seguintes comandos:","inicia o farm","pausa o farm","recebe o status atual do farm","Se você não receber uma mensagem de OK em retorno, quer dizer que o FarmOverflow não recebeu a mensagem ou que um comando inválido foi usado.","Atenção: Só funciona se você for o único participante da mensagem!","Você pode usar a mesma mensagem para executar outros comandos, bastando responde-la."]},settings:{basicSettings:"Configurações Básicas",eventsLimit:"Número máximo de registros",groupIgnore:"Ignorar aldeias do grupo",groupInclude:"Incluir alvos do grupo",groupOnly:"Atacar apenas com aldeias do grupo",language:"Linguagem da interface (requer reinício)",maxDistance:"Distância máxima dos alvos",maxTravelTime:"Tempo máximo de viagem (ida)",minDistance:"Distância mínima dos alvos",others:"Outros",presetName:"Predefinição das tropas",randomBase:"Base do intervalo aleatório (segundos)",ignoreOnLoss:"Ignorar aldeias que causarem perdas<br/>(Necessita de um grupo de ignorados ativo)",save:"Salvar configurações",saved:"Configurações salvas!",filters:"Filtros",presets:"Predefinições",villages:"Aldeias",security:"Segurança",minPoints:"Pontuação mínima dos alvos",maxPoints:"Pontuação máxima dos alvos",priorityTargets:"Priorizar alvos com de saque lotado",events:"Registros",eventAttack:"Mostrar registros de ataques",eventVillageChange:"Mostrar registros de troca de aldeias",eventPriorityAdd:"Mostrar registros de alvos prioritarios",eventIgnoredVillage:"Mostrar registros de aldeias ignoradas",remote:"Controle via mensagem (assunto)",hotkeySwitch:"Tecla de atalho para inicar/pausar (requer reinício)",hotkeyWindow:"Tecla de atalho para abrir janela (requer reinício)"}},en_us:{title:"FarmOverflow",events:{attacking:"Attacking.",commandLimit:"Limit of 50 attacks reached, waiting return.",lastAttack:"Last attack",nextVillage:"Changing to village {0}",noPreset:"No presets avaliable.",noSelectedVillage:"No villages avaliable.",noUnits:"No units avaliable in village, waiting attacks return.",noUnitsNoCommands:"No villages has units or commands returning.",noVillages:"No villages avaliable, waiting attacks return.",nothingYet:"Nothing available yet...",paused:"Paused.",presetFirst:"Set a preset first!",selectedVillage:"Village selected",sendCommand:"{0} attack {1}",status:"Status",loadingTargets:"Loading targets...",checkingTargets:"Checking targets...",restartingCommands:"Restarting commands...",ignoredVillage:"Target {0} ignored! (caused loss)",priorityTargetAdded:"{0} added to priorities."},general:{disabled:"— Disabled —",events:"Task Logs",info:"Information",none:"None",pause:"Pause",paused:"FarmOverflow paused.",settings:"Settings",start:"Start",started:"FarmOverflow started."},info:{development:["Development","Developed from <span class='brazil'>Brazil</span> with <strong style='color:#ad0202'>❤</strong> by","Any email reporting error, suggestion, messages of love or hate will be wellcome.","This project is"],groupOnly:["Using only villages from a group to attack","You can select a specific group to use only the villages from that group to attack."],ignore:["Ignoring villages from a group","You can select ignore targets setting a Ignore Group. All villages that assigned in that group will be ignored by the FarmOverflow. <strong>The group works on targets and your own villages as well</strong>."],include:["Including targets with a group","As well as ignoring villages, you can include village targets of players. Works only in villages inside the maximum distance range."],presets:["Setting presets","FarmOverflow uses the game's presets that you set up, you just need to select one on the settings tab, save and run to start the farm!","As the game only allows send presets that is activated on the village. FarmOverflow will activate it automatically if not already activated.","You can user more than one preset, <strong>since it have the same name</strong> (you can put a small description at the end to help identification)","See some name exemples for presets:","Attention with <strong>officers</strong>, they <strong>will be used</strong> if they are activated on the presets."],randomBase:["Random interval base","That interval is a random period of time (in seconds) between each attack avoid the FarmOverflow to be detected by the game. <strong>The bigger the better</strong>."],ignoreOnLoss:["Ignoring targets that cause loss","This option will ignore any target that cause loss in your troops.","The target that cause any loss to your troops will be ignored in the future.",'<strong>Note</strong>: For this feature works properly, the option "Ignore villages from group" must be set.'],priorityTargets:["Prioritizing targets","When activated, all targets that has full haul reports, will be added to the list of priorities, to resend the attack as soon as possible."],remote:["Controlling remotelly via message","Let the FarmOverflow working in home and control it by the app of game!",'Set the subject of message where you will control the FarmOverflow in the "Settings" tab',"Create a message and add yourself as a recipient. On the subject put what you set, and in the message use one of the fallowing commands:","start the farm","pause the farm","receive the current status of farm",'If you don\'t receive the message "OK" in return, means that the FarmOverflow did not receive the message or the command was invalid.',"Attention: Works only if you are the only participant in the message!","You can use the same message to execute other commands, just reply the message."]},settings:{basicSettings:"Basic Settings",eventsLimit:"Maximum length of task logs",groupIgnore:"Ignore villages from group",groupInclude:"Include targets from group",groupOnly:"Attack only with villages from group",language:"Interface language (require restart)",maxDistance:"Targets maximum distance",maxTravelTime:"Maximum travel time (going)",minDistance:"Targets minimum distance",others:"Others",presetName:"Preset of troops",randomBase:"Random interval base (seconds)",ignoreOnLoss:"Ignore villages that cause loss<br/>(Need a active group of ignoreds)",save:"Save settings",saved:"Settings saved!",filters:"Filters",presets:"Presets",villages:"Villages",security:"Security",minPoints:"Targets minimum points",maxPoints:"Targets maximum points",priorityTargets:"Prioritize targets with full loot report",events:"Task logs",eventAttack:"Show task logs of attacks",eventVillageChange:"Show task logs of village's changes",eventPriorityAdd:"Show task logs of priority targets",eventIgnoredVillage:"Show task logs of ignored villages",remote:"Control via message (subject)",hotkeySwitch:"Hotkey to start/pause",hotkeyWindow:"Hotkey to open window"}}},b=p.LANGUAGE,c={pt_pt:"pt_br",en_dk:"en_us"};if(b in c&&(b=c[b]),this.settings.language)this.lang=a[this.settings.language];else{let c=b in a?b:"en_us";this.lang=a[c],this.settings.language=c}},q}),define("FarmOverflow/Commander",["FarmOverflow/analytics","helper/math"],function(a,b){function c(a){this.farmOverflow=a,this.preventNextCommand=!1,this.timeoutId=null,this.running=!1}return c.prototype.start=function(){this.farmOverflow.event("start"),this.running=!0,this.analyse()},c.prototype.stop=function(){this.farmOverflow.event("pause"),this.running=!1,clearTimeout(this.timeoutId)},c.prototype.analyse=function(){let a=this.farmOverflow;if(this.running){if(!a.presets.length)return a.stop(),void a.event("noPreset");if(!a.hasVillage())return a.event("noVillageSelected");if(!a.village.loaded())return void a.village.load(()=>{a.analyse()});if(a.isWaiting()||a.isIgnored())return void(a.nextVillage()?this.analyse():a.event(a.lastError));if(!a.targetsLoaded())return a.getTargets(()=>{this.analyse()});if(!a.hasTarget())return void(a.nextVillage()?this.analyse():a.event("noTargets"));a.selectTarget(),a.checkPresets(()=>{if(a.village.countCommands()>=48)return this.handleError("commandLimit");let b=this.getPreset();if(b.error)return this.handleError(b.error);this.getPresetNext(b);this.send(b)})}},c.prototype.handleError=function(a){a=a||this.preventNextCommand;let b=this.farmOverflow;this.preventNextCommand=!1,b.lastError=a;let c=b.village.id;switch(a){case"timeLimit":b.nextTarget(),this.analyse();break;case"noUnits":if(b.event("noUnits",[b.village]),b.waiting[c]=!0,b.singleVillage){if(0===b.village.countCommands())return b.event("noUnitsNoCommands");b.globalWaiting=!0}else b.nextVillage()?this.analyse():b.globalWaiting=!0;break;case"commandLimit":if(b.waiting[c]=!0,b.singleVillage)b.globalWaiting=!0,b.event("commandLimitSingle",[b.village]);else{if(b.isAllWaiting())return b.event("commandLimitMulti",[b.village]),b.globalWaiting=!0,!1;b.nextVillage(),this.analyse()}}},c.prototype.getPreset=function(a){let b=this.farmOverflow,c=!1,d=a||b.village.units;for(let a of b.presets){let b=!0;for(let c in a.units)d[c].in_town<a.units[c]&&(b=!1);if(b){if(this.checkPresetTime(a))return a;c=!0}else;}return{error:c?"timeLimit":"noUnits"}},c.prototype.getPresetNext=function(a){let b=this.farmOverflow,c=angular.copy(b.village.units),d=a.units;for(let a in d)c[a].in_town-=d[a];let e=this.getPreset(c);e.error&&(this.preventNextCommand=e.error)},c.prototype.checkPresetTime=function(a){let c=this.farmOverflow,d=r.calculateTravelTime(a,{barbarian:!c.target.pid,officers:!1}),f=c.village.position,g={x:c.target.x,y:c.target.y},h=b.actualDistance(f,g),i=r.getTravelTimeForDistance(a,d,h,"attack");return e(c.settings.maxTravelTime)>i},c.prototype.send=function(a,b){if(!this.running)return!1;let c,e,f=this.farmOverflow;return this.simulate(),c=this.onCommandError(()=>{e();f.village.updateCommands(()=>{this.analyse()})}),e=this.onCommandSend(()=>{c();f.nextTarget();let a;a=d(f.settings.randomBase);a=1e3+1e3*a;this.timeoutId=setTimeout(()=>{if(this.preventNextCommand)return this.handleError();this.analyse()},a);f.updateActivity()}),k.emit(l.SEND_PRESET,{start_village:f.village.id,target_village:f.target.id,army_preset_id:a.id,type:"attack"}),!0},c.prototype.onCommandSend=function(b){let c=this.farmOverflow,d=angular.copy(c.village.units),e=i.$on(m.VILLAGE_UNIT_INFO,(f,g)=>{if(c.village.id!==g.village_id)return!1;let h=c.village.units;let i=angular.equals(d,h);if(i)return!1;c.event("sendCommand",[c.village,c.target]);a.attack();e();b()});return e},c.prototype.onCommandError=function(b){let c=(this.farmOverflow,i.$on(m.MESSAGE_ERROR,(d,e)=>{if(!e.cause||!e.code)return!1;if("Command/sendPreset"!==e.cause)return!1;if("Command/attackLimitExceeded"!==e.code)return!1;a.attackError();c();b()}));return c},c.prototype.simulate=function(a){let b=this.farmOverflow;(()=>{k.emit(l.GET_ATTACKING_FACTOR,{target_id:b.target.id})})(),a&&a()},c}),define("FarmOverflow/Village",["models/CommandListModel","models/CommandModel","conf/village"],function(a,b,c){function d(a){this.original=a,this.id=a.data.villageId,this.x=a.data.x,this.y=a.data.y,this.name=a.data.name,this.units=a.unitInfo.units,this.position=a.getPosition()}return d.prototype.countCommands=function(){let a=this.original.getCommandListModel();return a.getOutgoingCommands(!0).length+a.getIncomingCommands(!0).length},d.prototype.updateCommands=function(c){k.emit(l.GET_OWN_COMMANDS,{village_id:this.id},d=>{let e=new a([],this.id);for(let a=0;a<d.commands.length;a++){let c=new b(d.commands[a]);e.add(c)}this.original.setCommandListModel(e);c()})},d.prototype.commandsLoaded=function(){return this.original.isReady(c.OWN_COMMANDS)},d.prototype.unitsLoaded=function(){return this.original.isReady(c.UNITS)},d.prototype.loaded=function(){return this.original.isInitialized()||s.initializeVillage(this.original),this.commandsLoaded()&&this.unitsLoaded()},d.prototype.load=function(a){if(this.loaded())return a();let b=0,c=0;this.commandsLoaded()||(b++,k.emit(l.GET_OWN_COMMANDS,{village_id:this.id},function(){++c===b&&a()})),this.unitsLoaded()||(b++,k.emit(l.VILLAGE_UNIT_INFO,{village_id:this.id},function(){++c===b&&a()}))},d}),define("FarmOverflow/Interface",["helper/time","queues/EventQueue"],function(a,b){function c(a){return this.farmOverflow=a,this.newSettings={},this.activeTab="info",this.events=Lockr.get("lastEvents",[],!0),this.eventCount=1,this.buildStyle(),this.buildWindow(),this.bindTabs(),this.bindSettings(),this.bindEvents(),this.updateGroupList(),this.populateEvents(),a.on("presetsLoaded",()=>{this.updatePresetList()}),t.isLoaded()&&this.updatePresetList(),a.on("presetsChange",()=>{this.updatePresetList()}),a.on("groupsChanged",()=>{this.updateGroupList()}),this.$close.on("click",()=>{this.closeWindow()}),q.add("esc",()=>{this.closeWindow()},["INPUT","SELECT","TEXTAREA"]),i.$on(m.WINDOW_CLOSED,()=>{this.closeWindow()}),this.$button.on("click",()=>{this.openWindow()}),this.$start.on("click",()=>{a.switch()}),q.add(a.settings.hotkeySwitch,()=>{a.switch()}),q.add(a.settings.hotkeyWindow,()=>{this.openWindow()}),a.on("start",()=>{this.$start.html(a.lang.general.pause);this.$start.removeClass("btn-green").addClass("btn-red")
;this.$button.removeClass("btn-green").addClass("btn-red")}),a.on("pause",()=>{this.$start.html(a.lang.general.start);this.$start.removeClass("btn-red").addClass("btn-green");this.$button.removeClass("btn-red").addClass("btn-green")}),this}return c.prototype.populateEvents=function(){let a=this.farmOverflow.settings;this.events.length>0&&this.$events.html("");for(let b=0;b<this.events.length&&!(this.eventCount>=a.eventsLimit);b++){let c=this.events[b];(a.eventAttack||"sendCommand"!==c.type)&&(a.eventVillageChange||"nextVillage"!==c.type)&&(a.eventPriorityAdd||"priorityTargetAdded"!==c.type)&&(a.eventIgnoredVillage||"ignoredVillage"!==c.type)&&this.addEvent(c,!0)}},c.prototype.buildStyle=function(){this.$style=document.createElement("style"),this.$style.type="text/css",this.$style.id="farmOverflow-style",this.$style.innerHTML='#farmOverflow-interface{position:relative;top:0;left:0;margin-bottom:10px}#farmOverflow-interface .button{white-space:nowrap;position:relative;top:0;left:0;width:60px;height:24px}#farmOverflow-interface .text,#farmOverflow-interface .quickview{margin:5px 0;font-size:12px}#farmOverflow-interface .quickview{display:none}#wrapper.window-open #farmOverflow-interface .button{left:720px}#farmOverflow-window{visibility:hidden}#farmOverflow-window h3{color:#000}#farmOverflow-window p{color:#000;margin:7px 0;padding:0 40px}#farmOverflow-window p span.sample{font-weight:bold;font-style:italic}#farmOverflow-window p span.brazil{color:green;font-weight:bold}#farmOverflow-window p .opensource{background:url(https://i.imgur.com/KFHdWXN.png);width:15px;height:15px;display:inline-block;vertical-align:-2px}#farmOverflow-window input[type=text],#farmOverflow-window input[type=number]{width:100%}#farmOverflow-window select{width:100%;padding:0 0 0 5px;font-size:14px;border:1px solid #976543;height:28px;text-decoration:none;text-align-last:center;border-radius:2px;font-weight:600;font-family:"Trebuchet MS";color:white;box-shadow:0 0 0 1px #421f09 inset,0 0 0 2px #976543 inset,0 0 0 3px #421f09 inset,0 -1px 1px 4px rgba(215,181,144,0.7) inset,0 0 1px 5px rgba(0,0,0,0.4) inset;-webkit-appearance:none;-moz-appearance:none;outline:none;background-image:url(https://i.imgur.com/SlaWRrX.png),url(https://i.imgur.com/e2qKrmX.png);background-repeat:no-repeat,repeat;background-position:293px -3px,top left;background-color:#b28e68}#farmOverflow-window .center{text-align:center}#farmOverflow-window .reduced{height:30px}#farmOverflow-window .farmOverflow-content-info a{font-weight:bold;color:#544231}#farmOverflow-settings input[type="text"],#farmOverflow-settings input[type="number"],#farmOverflow-settings select{color:black;text-align:center}#farmOverflow-settings [class^="icon-"]{display:inline;margin:0 9px 0 0}#farmOverflow-settings .icon-34x34-preset,#farmOverflow-settings .icon-26x26-time,#farmOverflow-settings .icon-26x26-info,#farmOverflow-settings .icon-26x26-double-arrow{zoom:.6}#farmOverflow-settings .icon-20x20-queue-indicator-short,#farmOverflow-settings .icon-20x20-queue-indicator-long,#farmOverflow-settings .icon-20x20-favourite{vertical-align:0;margin:0 5px 0 0}#farmOverflow-settings .icon-34x34-preset,#farmOverflow-settings .icon-26x26-time{vertical-align:3px}#farmOverflow-settings .icon-26x26-double-arrow{vertical-align:4px}#farmOverflow-settings .icon-26x26-info{vertical-align:5px}#farmOverflow-settings .icon-34x34-points-per-village,#farmOverflow-settings .icon-34x34-name_changed{zoom:.5;vertical-align:6px}#farmOverflow-settings .icon-26x26-message-misc{vertical-align:1px}#farmOverflow-settings .icon-34x34-general{zoom:.5}#farmOverflow-settings .icon-26x26-time-spy{zoom:.7}#farmOverflow-settings td{text-align:center}#farmOverflow-save{color:white;width:180px;height:25px;margin:6px;line-height:24px;border:none}@keyframes farmOverflowShowStatus{0%{width:60px}100%{width:220px}}@keyframes farmOverflowHideStatus{0%{width:220px}100%{width:60px}}.farmOverflow-show-status{animation:farmOverflowShowStatus .1s forwards}.farmOverflow-hide-status{animation:farmOverflowHideStatus .1s forwards}',document.querySelector("head").appendChild(this.$style)},c.prototype.buildWindow=function(){this.$wrapper=$("#wrapper"),this.$window=document.createElement("section"),this.$window.id="farmOverflow-window",this.$window.className="farmOverflow-window twx-window screen left";let a=angular.merge({version:this.farmOverflow.version,author:{name:"Relaxeaza",email:"mafrazzrafael@gmail.com",url:"https://github.com/mafrazz"}},this.farmOverflow.lang),b=g('<div class="win-content message-list-wrapper searchable-list ng-scope"><header class="win-head"><h2 class="ng-binding">{{ this.title }} <span class="small">v{{ this.version }}</span></h2><ul class="list-btn"><li><a href="#" id="farmOverflow-close" class="size-34x34 btn-red icon-26x26-close"></a></li></ul></header><div class="win-main"><div class="tabs tabs-bg"><div class="tabs-three-col"><div class="tab" tab="info"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange">{{ this.general.info }}</a></div></div></div><div class="tab" tab="settings"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange">{{ this.general.settings }}</a></div></div></div><div class="tab" tab="log"><div class="tab-inner"><div><a href="#" class="btn-icon btn-orange">{{ this.general.events }}</a></div></div></div></div></div><div class="box-paper footer has-footer-upper farmOverflow-content-info"><img src="https://i.imgur.com/0ZBQWrb.png"><h5 class="twx-section">{{ this.info.development[0] }}</h5><div><p class="center">{{ this.info.development[1] }} <a href="{{ this.author.url }}">{{ this.author.name }}</a> &lt;{{ this.author.email }}&gt;</p><p class="center">{{ this.info.development[2] }}</p><p class="center">{{ this.info.development[3] }} <span class="opensource"></span> <a href="https://github.com/FarmOverflow/FarmOverflow">Open Source</a></p></div><h5 class="twx-section">{{ this.info.presets[0] }}</h5><div><p>{{ this.info.presets[1] }}</p><p>{{ this.info.presets[2] }}</p><p>{{ this.info.presets[3] }}</p><p>{{ this.info.presets[4] }}</p><p><span class="sample">Farm (Spears)</span><br><span class="sample">Farm "Lança"</span><br><span class="sample">Farm {Cavalary}</span></p><p>{{ this.info.presets[5] }}</p></div><h5 class="twx-section">{{ this.info.ignore[0] }}</h5><div><p>{{ this.info.ignore[1] }}</p></div><h5 class="twx-section">{{ this.info.include[0] }}</h5><div><p>{{ this.info.include[1] }}</p></div><h5 class="twx-section">{{ this.info.randomBase[0] }}</h5><div><p>{{ this.info.randomBase[1] }}</p></div><h5 class="twx-section">{{ this.info.groupOnly[0] }}</h5><div><p>{{ this.info.groupOnly[1] }}</p></div><h5 class="twx-section">{{ this.info.ignoreOnLoss[0] }}</h5><div><p>{{ this.info.ignoreOnLoss[1] }}</p><p>{{ this.info.ignoreOnLoss[2] }}</p><p>{{ this.info.ignoreOnLoss[3] }}</p></div><h5 class="twx-section">{{ this.info.priorityTargets[0] }}</h5><div><p>{{ this.info.priorityTargets[1] }}</p></div><h5 class="twx-section">{{ this.info.remote[0] }}</h5><div><p>{{ this.info.remote[1] }}</p><p>{{ this.info.remote[2] }}</p><p>{{ this.info.remote[3] }}</p><p>&bull; <b>on</b> <i>{{ this.info.remote[4] }}</i></p><p>&bull; <b>off</b> <i>{{ this.info.remote[5] }}</i></p><p>&bull; <b>status</b> <i>{{ this.info.remote[6] }}</i></p><p>{{ this.info.remote[7] }}</p><p>{{ this.info.remote[8] }}</p><p>{{ this.info.remote[9] }}</p></div></div><div class="box-paper footer has-footer-upper farmOverflow-content-settings"><form id="farmOverflow-settings"><h5 class="twx-section">{{ this.settings.presets }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-34x34-preset"></span> <span class="ff-cell-fix">{{ this.settings.presetName }}</span></td><td><select name="presetName" id="farmOverflow-preset"></select></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.villages }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-20x20-queue-indicator-short"></span> <span class="ff-cell-fix">{{ this.settings.groupIgnore }}</span></td><td><select name="groupIgnore" id="farmOverflow-ignore"></select></td></tr><tr><td><span class="icon-20x20-queue-indicator-long"></span> <span class="ff-cell-fix">{{ this.settings.groupInclude }}</span></td><td><select name="groupInclude" id="farmOverflow-include"></select></td></tr><tr><td><span class="icon-20x20-favourite"></span> <span class="ff-cell-fix">{{ this.settings.groupOnly }}</span></td><td><select name="groupOnly" id="farmOverflow-only"></select></td></tr><tr><td><span class="icon-34x34-name_changed"></span> <span class="ff-cell-fix">{{ this.settings.priorityTargets }}</span></td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-priorityTargets"><input id="settings-priorityTargets" type="checkbox" name="priorityTargets"></label></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.filters }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-26x26-double-arrow"></span> <span class="ff-cell-fix">{{ this.settings.minDistance }}</span></td><td><input name="minDistance" type="number" class="textfield-border" min="0" max="60" required></td></tr><tr><td><span class="icon-26x26-double-arrow"></span> <span class="ff-cell-fix">{{ this.settings.maxDistance }}</span></td><td><input name="maxDistance" type="number" class="textfield-border" min="1" max="60" required></td></tr><tr><td><span class="icon-34x34-points-per-village"></span> <span class="ff-cell-fix">{{ this.settings.minPoints }}</span></td><td><input name="minPoints" type="number" class="textfield-border" required></td></tr><tr><td><span class="icon-34x34-points-per-village"></span> <span class="ff-cell-fix">{{ this.settings.maxPoints }}</span></td><td><input name="maxPoints" type="number" class="textfield-border" required></td></tr><tr><td><span class="icon-26x26-time"></span> <span class="ff-cell-fix">{{ this.settings.maxTravelTime }}</span></td><td><input name="maxTravelTime" type="text" class="textfield-border" pattern="\\\\d{1,2}:\\\\d{1,2}:\\\\d{1,2}" required></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.security }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="ff-cell-fix">{{ this.settings.randomBase }}</span></td><td><input name="randomBase" type="number" class="textfield-border" min="0" required></td></tr><tr><td>{{ this.settings.ignoreOnLoss }}</td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-ignoreOnLoss"><input id="settings-ignoreOnLoss" type="checkbox" name="ignoreOnLoss"></label></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.events }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-26x26-info"></span> <span class="ff-cell-fix">{{ this.settings.eventsLimit }}</span></td><td><input name="eventsLimit" type="number" class="textfield-border" min="1" required></td></tr><tr><td>{{ this.settings.eventAttack }}</td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventAttack"><input id="settings-eventAttack" type="checkbox" name="eventAttack"></label></td></tr><tr><td>{{ this.settings.eventVillageChange }}</td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventVillageChange"><input id="settings-eventVillageChange" type="checkbox" name="eventVillageChange"></label></td></tr><tr><td>{{ this.settings.eventPriorityAdd }}</td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventPriorityAdd"><input id="settings-eventPriorityAdd" type="checkbox" name="eventPriorityAdd"></label></td></tr><tr><td>{{ this.settings.eventIgnoredVillage }}</td><td><label class="size-26x26 btn-orange icon-26x26-checkbox" for="settings-eventIgnoredVillage"><input id="settings-eventIgnoredVillage" type="checkbox" name="eventIgnoredVillage"></label></td></tr></tbody></table><h5 class="twx-section">{{ this.settings.others }}</h5><table class="tbl-border-light tbl-striped"><colgroup><col width="50%"><col></colgroup><tbody><tr><td><span class="icon-26x26-message-misc"></span> <span class="ff-cell-fix">{{ this.settings.remote }}</span></td><td><input name="remoteId" type="text" class="textfield-border" min="3" max="45"></td></tr><tr><td>{{ this.settings.hotkeySwitch }}</td><td><input name="hotkeySwitch" type="text" class="textfield-border"></td></tr><tr><td>{{ this.settings.hotkeyWindow }}</td><td><input name="hotkeyWindow" type="text" class="textfield-border"></td></tr><tr><td><span class="icon-34x34-general"></span> <span class="ff-cell-fix">{{ this.settings.language }}</span></td><td><select name="language" id="farmOverflow-language"><option value="en_us">English</option><option value="pt_br">Português</option></select></td></tr></tbody></table><br><div class="center"><input class="btn-orange btn-border" id="farmOverflow-save" type="submit" value="{{ this.settings.save }}"></div></form></div><div class="box-paper footer has-footer-upper farmOverflow-content-log"><div class="screen-tribe-news rich-text"><h5 class="twx-section">{{ this.events.status }}</h5><table class="tbl-border-light tbl-news tbl-big-header"><colgroup><col width="135px"><col width="*"></colgroup><tbody><tr class="list-item"><td id="farmOverflow-status" colspan="2" class="cell-center">{{ this.events.paused }}</td></tr><tr class="reduced"><td>{{ this.events.selectedVillage }}</td><td id="farmOverflow-selected"></td></tr><tr class="reduced"><td>{{ this.events.lastAttack }}</td><td id="farmOverflow-last">{{ this.general.none }}</td></tr></tbody></table><h5 class="twx-section">{{ this.general.events }}</h5><table class="tbl-border-light tbl-news tbl-big-header"><colgroup><col width="135px"><col width="*"></colgroup><tbody id="farmOverflow-events"><tr class="reduced"><td class="tribe-event-detail" colspan="2"><div class="text-tribe-news"><span>{{ this.events.nothingYet }}</span></div></td></tr></tbody></table></div></div></div><footer class="win-foot"><ul class="list-btn list-center"><li><a class="btn-orange btn-border" id="farmOverflow-start">{{ this.general.start }}</a></li></ul></footer></div>',a);this.$window.innerHTML=b,this.$wrapper.append(this.$window);let c=document.createElement("div");c.id="farmOverflow-interface",c.innerHTML='<div class="btn-border btn-green button"><div class="top-left"></div><div class="top-right"></div><div class="middle-top"></div><div class="middle-bottom"></div><div class="middle-left"></div><div class="middle-right"></div><div class="bottom-left"></div><div class="bottom-right"></div><div class="text">Farm</div><div class="quickview"></div></div>',$("#toolbar-left").prepend(c),this.$scrollbar=jsScrollbar(this.$window.querySelector(".win-main")),this.$button=$(".button",c),this.$quickview=this.$button.find(".quickview"),this.$settings=$("#farmOverflow-settings"),this.$start=$("#farmOverflow-start"),this.$close=$("#farmOverflow-close"),this.$preset=$("#farmOverflow-preset"),this.$groupIgnore=$("#farmOverflow-ignore"),this.$groupInclude=$("#farmOverflow-include"),this.$groupOnly=$("#farmOverflow-only"),this.$language=$("#farmOverflow-language"),this.$events=$("#farmOverflow-events"),this.$status=$("#farmOverflow-status"),this.$last=$("#farmOverflow-last"),this.$selected=$("#farmOverflow-selected"),this.updateLastAttack(),this.updateSelectedVillage(),this.bindQuickview()},c.prototype.updateLastAttack=function(a){if(a||-1!==(a=this.farmOverflow.lastAttack)){let b=n("readableDateFilter")(a),c=this.farmOverflow.lang.events.lastAttack;this.$last.html(b),this.$quickview.html(c+": "+b)}},c.prototype.updateSelectedVillage=function(){let a=this.farmOverflow.village;if(!a)return this.$selected.html(this.farmOverflow.lang.general.none),!1;let b=h("village",`${a.name} (${a.x}|${a.y})`,this.farmOverflow.village.id);this.$selected.html(""),this.$selected.append(b.elem)},c.prototype.bindQuickview=function(){let a=this.$button.find(".text"),b=this.farmOverflow.lang.events.lastAttack;this.$button.on("mouseenter",()=>{this.$button.addClass("farmOverflow-show-status");this.$button.removeClass("farmOverflow-hide-status");this.$quickview.html(`${b}: ${this.$last.html()}`);a.hide();this.$quickview.show()}),this.$button.on("mouseleave",()=>{this.$button.removeClass("farmOverflow-show-status");this.$button.addClass("farmOverflow-hide-status");this.$quickview.hide();a.show()})},c.prototype.openWindow=function(){p.closeAll(),this.$window.style.visibility="visible",this.$wrapper.addClass("window-open"),b.trigger(b.types.RESIZE,{instant:!0,right:!0})},c.prototype.closeWindow=function(){this.$window.style.visibility="hidden",this.$wrapper.removeClass("window-open"),b.trigger(b.types.RESIZE,{instant:!0,right:!0})},c.prototype.toggleWindow=function(a){this.$window.style.visibility=a,this.$wrapper.toggleClass("window-open"),b.trigger(b.types.RESIZE,{instant:!0,right:!0})},c.prototype.tabsState=function(){for(let a of this.$tabs){let b=a.getAttribute("tab"),c=this.$window.querySelector(`.farmOverflow-content-${b}`),d=a.querySelector(".tab-inner > div"),e=a.querySelector("a");this.activeTab===b?(c.style.display="",a.classList.add("tab-active"),d.classList.add("box-border-light"),e.classList.remove("btn-icon","btn-orange"),this.$scrollbar.content=c):(c.style.display="none",a.classList.remove("tab-active"),d.classList.remove("box-border-light"),e.classList.add("btn-icon","btn-orange")),this.$scrollbar.recalc()}},c.prototype.bindTabs=function(){this.$tabs=this.$window.querySelectorAll(".tab");for(let a of this.$tabs){let b=a.getAttribute("tab");a.addEventListener("click",()=>{this.activeTab=b;this.tabsState()})}this.tabsState()},c.prototype.eachSetting=function(a){for(let b in this.farmOverflow.settings){let c=$(`[name="${b}"]`,this.$window);c.length&&a(c)}},c.prototype.bindSettings=function(){this.eachSetting(a=>{let b=a[0].type;let c=a[0].name;if("select-one"===b)return void("language"===c&&(a[0].value=this.farmOverflow.settings.language));if("checkbox"===b)return this.farmOverflow.settings[c]&&(a[0].checked=!0,a.parent().addClass("icon-26x26-checkbox-checked")),void a.on("click",()=>{a.parent().toggleClass("icon-26x26-checkbox-checked")});a.val(this.farmOverflow.settings[c])}),this.$settings.on("submit",a=>{a.preventDefault();if(this.$settings[0].checkValidity()){let a={};this.eachSetting(b=>{let c=b[0].name;b[0].type;let d=b.val();"number"===b[0].type&&(d=parseInt(d,10));a[c]=d}),this.farmOverflow.updateSettings(a),this.farmOverflow.notif("success",this.farmOverflow.lang.settings.saved)}})},c.prototype.addEvent=function(b,c){let d=this.farmOverflow.settings.eventsLimit;this.eventCount>=d&&this.$events.find("tr:last-child").remove(),this.events.length>=d&&this.events.pop(),this.addRow(this.$events,b,c),this.eventCount++,c||(b.timestamp=a.gameTime(),this.events.unshift(b),Lockr.set("lastEvents",this.events))},c.prototype.addRow=function(b,c,d){let e=[];if(c=angular.copy(c),c.links){for(let a=0;a<c.links.length;a++)e.push(h(c.links[a].type,c.links[a].name));c.type?c.text=f(this.farmOverflow.lang.events[c.type],e):c.text=f(c.text,e)}let i=document.createElement("tr");if(i.className="reduced",i.innerHTML=g('<td class="tribe-event-time">{{ this.date }}</td><td class="tribe-event-detail"><span class="icon-bg-black icon-26x26-{{ this.icon }}"></span><div class="text-tribe-news"><span>{{ this.text }}</span></div></td>',{date:n("readableDateFilter")(c.timestamp||a.gameTime()),icon:c.icon,text:c.text}),c.icon||(i.querySelector(".icon-bg-black").remove(),i.querySelector(".text-tribe-news").className=""),c.links)for(let a=0;a<e.length;a++)c.links[a].elem=i.querySelector("#"+e[a].id),c.links[a].elem.addEventListener("click",function(){o.openVillageInfo(c.links[a].id)});b[d?"append":"prepend"](i),this.$scrollbar.recalc()},c.prototype.updatePresetList=function(){let a={},b=j.getPresetList().presets;this.$preset.html(`<option value="">${this.farmOverflow.lang.general.disabled}</option>`);for(let c in b){let d=b[c].name.replace(u,"").trim();if(!(d in a)&&d){let b="";this.farmOverflow.settings.presetName===d&&(b="selected"),this.$preset.append(`<option value="${d}" ${b}>${d}</option>`),a[d]=!0}}},c.prototype.updateGroupList=function(){let a=["groupIgnore","groupInclude","groupOnly"],b=j.getGroupList().getGroups();for(let c of a){let a="$"+c;this[a].html(`<option value="">${this.farmOverflow.lang.general.disabled}</option>`);for(let d in b){let e=b[d].name,f="";this.farmOverflow.settings[c]==d&&(f="selected"),this[a].append(`<option value="${d}" ${f}>${e}</option>`)}}},c.prototype.bindEvents=function(){let b=this.farmOverflow.settings,c={sendCommand:(c,d)=>{this.$status.html(this.farmOverflow.lang.events.attacking);this.updateLastAttack(a.gameTime());if(!b.eventAttack)return!1;let e=`${c.name} (${c.x}|${c.y})`;let f=`${d.name} (${d.x}|${d.y})`;this.addEvent({links:[{type:"village",name:e,id:c.id},{type:"village",name:f,id:d.id}],icon:"attack-small",type:"sendCommand"})},nextVillage:a=>{this.updateSelectedVillage();if(!b.eventVillageChange)return!1;let c=`${a.name} (${a.x}|${a.y})`;this.addEvent({links:[{type:"village",name:c,id:a.id}],icon:"village",type:"nextVillage"})},ignoredVillage:a=>{if(!b.eventIgnoredVillage)return!1;let c=`${a.name} (${a.x}|${a.y})`;this.addEvent({links:[{type:"village",name:c,id:a.id}],icon:"check-negative",type:"ignoredVillage"})},priorityTargetAdded:a=>{if(!b.eventPriorityAdd)return!1;let c=`${a.name} (${a.x}|${a.y})`;this.addEvent({links:[{type:"village",name:c,id:a.id}],icon:"parallel-recruiting",type:"priorityTargetAdded"})},noPreset:()=>{this.addEvent({icon:"info",type:"noPreset"});this.$status.html(this.farmOverflow.lang.events.paused)},noUnits:()=>{this.farmOverflow.singleVillage&&this.$status.html(this.farmOverflow.lang.events.noUnits)},noUnitsNoCommands:()=>{this.$status.html(this.farmOverflow.lang.events.noUnitsNoCommands)},start:()=>{this.$status.html(this.farmOverflow.lang.events.attacking)},pause:()=>{this.$status.html(this.farmOverflow.lang.events.paused)},noVillages:()=>{this.$status.html(this.farmOverflow.lang.events.noVillages)},villagesUpdate:()=>{this.updateSelectedVillage()},startLoadingTargers:()=>{this.$status.html(this.farmOverflow.lang.events.loadingTargets)},endLoadingTargers:()=>{this.$status.html(this.farmOverflow.lang.events.analyseTargets)},attacking:()=>{this.$status.html(this.farmOverflow.lang.events.attacking)},commandLimitSingle:()=>{this.$status.html(this.farmOverflow.lang.events.commandLimit)},commandLimitMulti:()=>{this.$status.html(this.farmOverflow.lang.events.noVillages)},resetEvents:()=>{this.eventCount=0;this.populateEvents()}};for(let a in c)this.farmOverflow.on(a,c[a])},c}),define("FarmOverflow/analytics",function(){let a=null,b=null,c=function(b){a||(a=b)},d=function(a){b||(b=a)};return{init:function(e){c(e),d(a.getWorldId()+"-"+a.getId()),ga("create","UA-92130203-4","auto","FarmOverflow"),ga("FarmOverflow.set","userId",b),ga("FarmOverflow.set","dimension1",a.getWorldId()),ga("FarmOverflow.set","dimension2",a.getId()),ga("FarmOverflow.set","dimension3",a.getRank()),ga("FarmOverflow.set","dimension4",a.getVillageList().length),ga("FarmOverflow.set","dimension5",a.getPoints()),ga("FarmOverflow.send","pageview")},attack:function(){if(!a)return!1;let c=b+"-"+a.getName()+"-"+injector.get("modelDataService").getPlayer().data.token;ga("FarmOverflow.send","event","commands","attack",c)},attackError:function(b){if(!a)return!1;ga("FarmOverflow.send","event","commands","attackError",b)},ignoreTarget:function(){if(!a)return!1;ga("FarmOverflow.send","event","commands","ignoreTarget")},priorityTarget:function(){if(!a)return!1;ga("FarmOverflow.send","event","commands","priorityTarget")},start:function(){if(!a)return!1;ga("FarmOverflow.send","event","behavior","start")},pause:function(){if(!a)return!1;ga("FarmOverflow.send","event","behavior","pause")},settingsChange:function(b){if(!a)return!1;ga("FarmOverflow.send","event","behavior","settingsChange",b)},villageChange:function(){if(!a)return!1;ga("FarmOverflow.send","event","behavior","villageChange")},remoteCommand:function(){if(!a)return!1;ga("FarmOverflow.send","event","behavior","remoteCommand")}}})}(),require(["FarmOverflow","FarmOverflow/Interface","FarmOverflow/analytics"],function(a,b,c){if(a.initialized)return!1;a.initialized=!0;let d=function(){let d=injector.get("modelDataService"),e=d.getSelectedCharacter();c.init(e),Lockr.prefix=`${e.getId()}_farmOverflow_`,window.farmOverflow=new a,window.farmOverflowInterface=new b(farmOverflow)},e=document.querySelector("#map");if(angular.element(e).scope().isInitialized)d();else{let a=angular.element(document).scope(),b=injector.get("eventTypeProvider");a.$on(b.MAP_INITIALIZED,d)}});
//# sourceMappingURL=farmoverflow.map